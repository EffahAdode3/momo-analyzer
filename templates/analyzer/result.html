{% extends 'analyzer/base.html' %}
{% block title %}Analysis Results{% endblock %}
{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- Header Section -->
            <div class="text-center mb-5">
                <i class="fas fa-chart-line fa-3x text-primary mb-3"></i>
                <h1 class="mb-3">ðŸ“Š MoMo Analysis Complete!</h1>
                <p class="lead text-muted">Your transaction analysis is ready. Here's what we found:</p>
            </div>

            <!-- Airtime Summary Card -->
            <div class="row justify-content-center mb-5">
                <div class="col-md-6">
                    <div class="card border-success shadow-sm h-100">
                        <div class="card-body text-center p-4">
                            <i class="fas fa-mobile-alt fa-2x text-success mb-3"></i>
                            <h4 class="card-title text-success">ðŸ“± Total Airtime Spent</h4>
                            <p class="display-6 text-success fw-bold mb-0">GHâ‚µ {{ airtime }}</p>
                            <small class="text-muted">Based on your transaction history</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary by Transaction Type -->
            <div class="card shadow-sm mb-5">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-list-alt me-2"></i>Summary by Transaction Type
                    </h4>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="px-4">
                                        <i class="fas fa-tag me-2"></i>Transaction Type
                                    </th>
                                    <th class="px-4">
                                        <i class="fas fa-money-bill-wave me-2"></i>Total Amount (GHâ‚µ)
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in summary %}
                                    <tr>
                                        <td class="px-4">
                                            <span class="badge bg-primary me-2">{{ forloop.counter }}</span>
                                            {{ row.Transaction_Type }}
                                        </td>
                                        <td class="px-4 fw-bold">{{ row.Total_Amount }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- All Transactions Table -->
            <div class="card shadow-sm mb-5">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-table me-2"></i>ðŸ“‹ All Transactions
                    </h4>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="px-4">
                                        <i class="fas fa-calendar me-2"></i>Date
                                    </th>
                                    <th class="px-4">
                                        <i class="fas fa-exchange-alt me-2"></i>Type
                                    </th>
                                    <th class="px-4">
                                        <i class="fas fa-coins me-2"></i>Amount
                                    </th>
                                    <th class="px-4">
                                        <i class="fas fa-user me-2"></i>Recipient
                                    </th>
                                    <th class="px-4">
                                        <i class="fas fa-comment me-2"></i>Description
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in table %}
                                    <tr>
                                        <td class="px-4">
                                            <span class="badge bg-secondary">{{ row.Date }}</span>
                                        </td>
                                        <td class="px-4">
                                            {% if row.Type == "Send Money" %}
                                                <span class="badge bg-danger">{{ row.Type }}</span>
                                            {% elif row.Type == "Receive Money" %}
                                                <span class="badge bg-success">{{ row.Type }}</span>
                                            {% elif row.Type == "Airtime" %}
                                                <span class="badge bg-warning">{{ row.Type }}</span>
                                            {% else %}
                                                <span class="badge bg-info">{{ row.Type }}</span>
                                            {% endif %}
                                        </td>
                                        <td class="px-4 fw-bold">{{ row.Amount }}</td>
                                        <td class="px-4">{{ row.TO_NAME }}</td>
                                        <td class="px-4 text-muted">{{ row.Description }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="text-center">
                <form method="post" action="{% url 'download_csv' %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="csv_data" value="{{ csv_data }}">
                    <button type="submit" class="btn btn-success btn-lg me-3">
                        <i class="fas fa-download me-2"></i>Download CSV Report
                    </button>
                </form>
                <a href="{% url 'upload' %}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-upload me-2"></i>Analyze Another Statement
                </a>
            </div>

            <!-- Insights Section -->
            <div class="mt-5 p-4 bg-light rounded-3">
                <h5 class="mb-3">
                    <i class="fas fa-lightbulb text-warning me-2"></i>Key Insights
                </h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Total transactions analyzed: <strong>{{ table|length }}</strong>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Transaction types found: <strong>{{ summary|length }}</strong>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Airtime spending: <strong>GHâ‚µ {{ airtime }}</strong>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check-circle text-success me-2"></i>
                                Analysis completed successfully
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
